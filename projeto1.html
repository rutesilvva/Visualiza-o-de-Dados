<!DOCTYPE html>
<html lang="pt-BR" style="height: 100%">
<head>
  <meta charset="utf-8">
  <title>Interatividade Pluviométrica</title>
</head>
<body style="height: 100%; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 20px; background: #f4f4f4;">

  <h2>Volume de Chuva na Fazenda Carnaúba (2013–2023)</h2>
  <button onclick="filtrarMenorQueMedia()" style="margin-bottom: 10px;">Exibir apenas anos com chuva abaixo da média</button>
  <button onclick="resetarFiltro()" style="margin-bottom: 20px;">Resetar Filtro</button>

  <div id="container" style="height: 80%; width: 90%; max-width: 900px;"></div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom);

    const anos = ['2013','2014','2015','2016','2017','2018','2019','2020','2021','2022','2023'];
    const valores = [280, 404.6, 386.7, 295, 211.5, 764.8, 497.9, 591.3, 388.5, 938.6, 376.6];

    const media = (valores.reduce((a, b) => a + b, 0)) / valores.length;

    function gerarSerie(dados) {
      return dados.map(v => ({
        value: v,
        itemStyle: {
          color: '#00BFFF'
        }
      }));
    }

    let option = {
      tooltip: {
        trigger: 'axis',
        formatter: function (params) {
          let ano = params[0].axisValue;
          let valor = params[0].data.value;
          return `${ano}<br/>Chuva: <b>${valor} mm</b>`;
        }
      },
      dataZoom: [
        {
          type: 'slider',
          start: 0,
          end: 100
        },
        {
          type: 'inside'
        }
      ],
      xAxis: {
        type: 'category',
        data: anos
      },
      yAxis: {
        type: 'value',
        name: 'Total de Chuva (mm)'
      },
      series: [{
        type: 'bar',
        data: gerarSerie(valores)
      }]
    };

    myChart.setOption(option);

    function filtrarMenorQueMedia() {
      const anosFiltrados = [];
      const dadosFiltrados = [];

      for (let i = 0; i < valores.length; i++) {
        if (valores[i] < media) {
          anosFiltrados.push(anos[i]);
          dadosFiltrados.push(valores[i]);
        }
      }

      myChart.setOption({
        xAxis: { data: anosFiltrados },
        series: [{ data: gerarSerie(dadosFiltrados) }]
      });
    }

    function resetarFiltro() {
      myChart.setOption({
        xAxis: { data: anos },
        series: [{ data: gerarSerie(valores) }]
      });
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>
